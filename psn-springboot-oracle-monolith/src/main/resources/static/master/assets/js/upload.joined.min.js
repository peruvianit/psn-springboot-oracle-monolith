!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(M){"use strict";var w={};w.fileapi=M("<input type='file'/>").get(0).files!==undefined,w.formdata=window.FormData!==undefined;var N=!!M.fn.prop;function r(e){var t=e.data;e.isDefaultPrevented()||(e.preventDefault(),M(e.target).ajaxSubmit(t))}function a(e){var t=e.target,r=M(t);if(!r.is("[type=submit],[type=image]")){var a=r.closest("[type=submit]");if(0===a.length)return;t=a[0]}var o=this;if(o.clk=t,"image"==t.type)if(e.offsetX!==undefined)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof M.fn.offset){var i=r.offset();o.clk_x=e.pageX-i.left,o.clk_y=e.pageY-i.top}else o.clk_x=e.pageX-t.offsetLeft,o.clk_y=e.pageY-t.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function P(){if(M.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}M.fn.attr2=function(){if(!N)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},M.fn.ajaxSubmit=function(A){if(!this.length)return P("ajaxSubmit: skipping submit process - no element selected"),this;var k,e,t,L=this;"function"==typeof A?A={success:A}:A===undefined&&(A={}),k=A.type||this.attr2("method"),e=A.url||this.attr2("action"),t="string"==typeof e?M.trim(e):"",t=t||window.location.href||"",t&&(t=(t.match(/^([^#]+)/)||[])[1]),A=M.extend(!0,{url:t,success:M.ajaxSettings.success,type:k||M.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},A);var r={};if(this.trigger("form-pre-serialize",[this,A,r]),r.veto)return P("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(A.beforeSerialize&&!1===A.beforeSerialize(this,A))return P("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var a=A.traditional;a===undefined&&(a=M.ajaxSettings.traditional);var o,z=[],i=this.formToArray(A.semantic,z);if(A.data&&(A.extraData=A.data,o=M.param(A.data,a)),A.beforeSubmit&&!1===A.beforeSubmit(i,this,A))return P("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[i,this,A,r]),r.veto)return P("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var n=M.param(i,a);o&&(n=n?n+"&"+o:o),"GET"==A.type.toUpperCase()?(A.url+=(0<=A.url.indexOf("?")?"&":"?")+n,A.data=null):A.data=n;var s=[];if(A.resetForm&&s.push(function(){L.resetForm()}),A.clearForm&&s.push(function(){L.clearForm(A.includeHidden)}),!A.dataType&&A.target){var l=A.success||function(){};s.push(function(e){var t=A.replaceTarget?"replaceWith":"html";M(A.target)[t](e).each(l,arguments)})}else A.success&&s.push(A.success);if(A.success=function(e,t,r){for(var a=A.context||this,o=0,i=s.length;o<i;o++)s[o].apply(a,[e,t,r||L,L])},A.error){var u=A.error;A.error=function(e,t,r){var a=A.context||this;u.apply(a,[e,t,r,L])}}if(A.complete){var d=A.complete;A.complete=function(e,t){var r=A.context||this;d.apply(r,[e,t,L])}}var c=M("input[type=file]:enabled",this).filter(function(){return""!==M(this).val()}),p=0<c.length,f="multipart/form-data",m=L.attr("enctype")==f||L.attr("encoding")==f,h=w.fileapi&&w.formdata;P("fileAPI :"+h);var v,g=(p||m)&&!h;!1!==A.iframe&&(A.iframe||g)?A.closeKeepAlive?M.get(A.closeKeepAlive,function(){v=x(i)}):v=x(i):v=(p||m)&&h?function(e){for(var r=new FormData,t=0;t<e.length;t++)r.append(e[t].name,e[t].value);if(A.extraData){var a=function(e){var t,r,a=M.param(e,A.traditional).split("&"),o=a.length,i=[];for(t=0;t<o;t++)a[t]=a[t].replace(/\+/g," "),r=a[t].split("="),i.push([decodeURIComponent(r[0]),decodeURIComponent(r[1])]);return i}(A.extraData);for(t=0;t<a.length;t++)a[t]&&r.append(a[t][0],a[t][1])}A.data=null;var o=M.extend(!0,{},M.ajaxSettings,A,{contentType:!1,processData:!1,cache:!1,type:k||"POST"});A.uploadProgress&&(o.xhr=function(){var e=M.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var t=0,r=e.loaded||e.position,a=e.total;e.lengthComputable&&(t=Math.ceil(r/a*100)),A.uploadProgress(e,r,a,t)},!1),e});o.data=null;var i=o.beforeSend;return o.beforeSend=function(e,t){A.formData?t.data=A.formData:t.data=r,i&&i.call(this,e,t)},M.ajax(o)}(i):M.ajax(A),L.removeData("jqxhr").data("jqxhr",v);for(var b=0;b<z.length;b++)z[b]=null;return this.trigger("form-submit-notify",[this,A]),this;function x(e){var t,r,c,p,l,f,m,h,a,o,v,g,u=L[0],b=M.Deferred();if(b.abort=function(e){h.abort(e)},e)for(r=0;r<z.length;r++)t=M(z[r]),N?t.prop("disabled",!1):t.removeAttr("disabled");if(c=M.extend(!0,{},M.ajaxSettings,A),c.context=c.context||c,l="jqFormIO"+(new Date).getTime(),c.iframeTarget?(f=M(c.iframeTarget),o=f.attr2("name"),o?l=o:f.attr2("name",l)):(f=M('<iframe name="'+l+'" src="'+c.iframeSrc+'" />'),f.css({position:"absolute",top:"-1000px",left:"-1000px"})),m=f[0],h={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var t="timeout"===e?"timeout":"aborted";P("aborting upload... "+t),this.aborted=1;try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(r){}f.attr("src",c.iframeSrc),h.error=t,c.error&&c.error.call(c.context,h,t,e),p&&M.event.trigger("ajaxError",[h,c,t]),c.complete&&c.complete.call(c.context,h,t)}},p=c.global,p&&0==M.active++&&M.event.trigger("ajaxStart"),p&&M.event.trigger("ajaxSend",[h,c]),c.beforeSend&&!1===c.beforeSend.call(c.context,h,c))return c.global&&M.active--,b.reject(),b;if(h.aborted)return b.reject(),b;a=u.clk,a&&(o=a.name,o&&!a.disabled&&(c.extraData=c.extraData||{},c.extraData[o]=a.value,"image"==a.type&&(c.extraData[o+".x"]=u.clk_x,c.extraData[o+".y"]=u.clk_y)));var x=1,w=2;function y(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(r){P("cannot get iframe.contentWindow document: "+r)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(r){P("cannot get iframe.contentDocument: "+r),t=e.document}return t}var i=M("meta[name=csrf-token]").attr("content"),n=M("meta[name=csrf-param]").attr("content");function s(){var t=L.attr2("target"),r=L.attr2("action"),a=L.attr("enctype")||L.attr("encoding")||"multipart/form-data";u.setAttribute("target",l),k&&!/post/i.test(k)||u.setAttribute("method","POST"),r!=c.url&&u.setAttribute("action",c.url),c.skipEncodingOverride||k&&!/post/i.test(k)||L.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),c.timeout&&(g=setTimeout(function(){v=!0,F(x)},c.timeout));var o=[];try{if(c.extraData)for(var i in c.extraData)c.extraData.hasOwnProperty(i)&&(M.isPlainObject(c.extraData[i])&&c.extraData[i].hasOwnProperty("name")&&c.extraData[i].hasOwnProperty("value")?o.push(M('<input type="hidden" name="'+c.extraData[i].name+'">').val(c.extraData[i].value).appendTo(u)[0]):o.push(M('<input type="hidden" name="'+i+'">').val(c.extraData[i]).appendTo(u)[0]));c.iframeTarget||f.appendTo("body"),m.attachEvent?m.attachEvent("onload",F):m.addEventListener("load",F,!1),setTimeout(function e(){try{var t=y(m).readyState;P("state = "+t),t&&"uninitialized"==t.toLowerCase()&&setTimeout(e,50)}catch(r){P("Server abort: ",r," (",r.name,")"),F(w),g&&clearTimeout(g),g=undefined}},15);try{u.submit()}catch(s){var n=document.createElement("form").submit;n.apply(u)}}finally{u.setAttribute("action",r),u.setAttribute("enctype",a),t?u.setAttribute("target",t):L.removeAttr("target"),M(o).remove()}}n&&i&&(c.extraData=c.extraData||{},c.extraData[n]=i),c.forceSync?s():setTimeout(s,10);var S,C,D,T=50;function F(e){if(!h.aborted&&!D){if(C=y(m),C||(P("cannot access response document"),e=w),e===x&&h)return h.abort("timeout"),b.reject(h,"timeout"),void 0;if(e==w&&h)return h.abort("server abort"),b.reject(h,"error","server abort"),void 0;if(C&&C.location.href!=c.iframeSrc||v){m.detachEvent?m.detachEvent("onload",F):m.removeEventListener("load",F,!1);var t,r="success";try{if(v)throw"timeout";var a="xml"==c.dataType||C.XMLDocument||M.isXMLDoc(C);if(P("isXml="+a),!a&&window.opera&&(null===C.body||!C.body.innerHTML)&&--T)return P("requeing onLoad callback, DOM not available"),setTimeout(F,250),void 0;var o=C.body?C.body:C.documentElement;h.responseText=o?o.innerHTML:null,h.responseXML=C.XMLDocument?C.XMLDocument:C,a&&(c.dataType="xml"),h.getResponseHeader=function(e){var t={"content-type":c.dataType};return t[e.toLowerCase()]},o&&(h.status=Number(o.getAttribute("status"))||h.status,h.statusText=o.getAttribute("statusText")||h.statusText);var i=(c.dataType||"").toLowerCase(),n=/(json|script|text)/.test(i);if(n||c.textarea){var s=C.getElementsByTagName("textarea")[0];if(s)h.responseText=s.value,h.status=Number(s.getAttribute("status"))||h.status,h.statusText=s.getAttribute("statusText")||h.statusText;else if(n){var l=C.getElementsByTagName("pre")[0],u=C.getElementsByTagName("body")[0];l?h.responseText=l.textContent?l.textContent:l.innerText:u&&(h.responseText=u.textContent?u.textContent:u.innerText)}}else"xml"==i&&!h.responseXML&&h.responseText&&(h.responseXML=E(h.responseText));try{S=j(h,i,c)}catch(d){r="parsererror",h.error=t=d||r}}catch(d){P("error caught: ",d),r="error",h.error=t=d||r}h.aborted&&(P("upload aborted"),r=null),h.status&&(r=200<=h.status&&h.status<300||304===h.status?"success":"error"),"success"===r?(c.success&&c.success.call(c.context,S,"success",h),b.resolve(h.responseText,"success",h),p&&M.event.trigger("ajaxSuccess",[h,c])):r&&(t===undefined&&(t=h.statusText),c.error&&c.error.call(c.context,h,r,t),b.reject(h,"error",t),p&&M.event.trigger("ajaxError",[h,c,t])),p&&M.event.trigger("ajaxComplete",[h,c]),p&&!--M.active&&M.event.trigger("ajaxStop"),c.complete&&c.complete.call(c.context,h,r),D=!0,c.timeout&&clearTimeout(g),setTimeout(function(){c.iframeTarget?f.attr("src",c.iframeSrc):f.remove(),h.responseXML=null},100)}}}var E=M.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},d=M.parseJSON||function(e){return window.eval("("+e+")")},j=function(e,t,r){var a=e.getResponseHeader("content-type")||"",o="xml"===t||!t&&0<=a.indexOf("xml"),i=o?e.responseXML:e.responseText;return o&&"parsererror"===i.documentElement.nodeName&&M.error&&M.error("parsererror"),r&&r.dataFilter&&(i=r.dataFilter(i,t)),"string"==typeof i&&("json"===t||!t&&0<=a.indexOf("json")?i=d(i):("script"===t||!t&&0<=a.indexOf("javascript"))&&M.globalEval(i)),i};return b}},M.fn.ajaxForm=function(e){if(e=e||{},e.delegation=e.delegation&&M.isFunction(M.fn.on),!e.delegation&&0===this.length){var t={s:this.selector,c:this.context};return!M.isReady&&t.s?(P("DOM not ready, queuing ajaxForm"),M(function(){M(t.s,t.c).ajaxForm(e)})):P("terminating; zero elements found by selector"+(M.isReady?"":" (DOM not ready)")),this}return e.delegation?(M(document).off("submit.form-plugin",this.selector,r).off("click.form-plugin",this.selector,a).on("submit.form-plugin",this.selector,e,r).on("click.form-plugin",this.selector,e,a),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,r).bind("click.form-plugin",e,a)},M.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},M.fn.formToArray=function(e,t){var r=[];if(0===this.length)return r;var a,o,i,n,s,l,u,d,c=this[0],p=this.attr("id"),f=e?c.getElementsByTagName("*"):c.elements;if(f&&!/MSIE [678]/.test(navigator.userAgent)&&(f=M(f).get()),p&&(a=M(':input[form="'+p+'"]').get(),a.length&&(f=(f||[]).concat(a))),!f||!f.length)return r;for(o=0,u=f.length;o<u;o++)if(l=f[o],n=l.name,n&&!l.disabled)if(e&&c.clk&&"image"==l.type)c.clk==l&&(r.push({name:n,value:M(l).val(),type:l.type}),r.push({name:n+".x",value:c.clk_x},{name:n+".y",value:c.clk_y}));else if(s=M.fieldValue(l,!0),s&&s.constructor==Array)for(t&&t.push(l),i=0,d=s.length;i<d;i++)r.push({name:n,value:s[i]});else if(w.fileapi&&"file"==l.type){t&&t.push(l);var m=l.files;if(m.length)for(i=0;i<m.length;i++)r.push({name:n,value:m[i],type:l.type});else r.push({name:n,value:"",type:l.type})}else null!=s&&(t&&t.push(l),r.push({name:n,value:s,type:l.type,required:l.required}));if(!e&&c.clk){var h=M(c.clk),v=h[0];n=v.name,n&&!v.disabled&&"image"==v.type&&(r.push({name:n,value:h.val()}),r.push({name:n+".x",value:c.clk_x},{name:n+".y",value:c.clk_y}))}return r},M.fn.formSerialize=function(e){return M.param(this.formToArray(e))},M.fn.fieldSerialize=function(o){var i=[];return this.each(function(){var e=this.name;if(e){var t=M.fieldValue(this,o);if(t&&t.constructor==Array)for(var r=0,a=t.length;r<a;r++)i.push({name:e,value:t[r]});else null!=t&&i.push({name:this.name,value:t})}}),M.param(i)},M.fn.fieldValue=function(e){for(var t=[],r=0,a=this.length;r<a;r++){var o=this[r],i=M.fieldValue(o,e);null==i||i.constructor==Array&&!i.length||(i.constructor==Array?M.merge(t,i):t.push(i))}return t},M.fieldValue=function(e,t){var r=e.name,a=e.type,o=e.tagName.toLowerCase();if(t===undefined&&(t=!0),t&&(!r||e.disabled||"reset"==a||"button"==a||("checkbox"==a||"radio"==a)&&!e.checked||("submit"==a||"image"==a)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var i=e.selectedIndex;if(i<0)return null;for(var n=[],s=e.options,l="select-one"==a,u=l?i+1:s.length,d=l?i:0;d<u;d++){var c=s[d];if(c.selected){var p=c.value;if(p||(p=c.attributes&&c.attributes.value&&!c.attributes.value.specified?c.text:c.value),l)return p;n.push(p)}}return n}return M(e).val()},M.fn.clearForm=function(e){return this.each(function(){M("input,select,textarea",this).clearFields(e)})},M.fn.clearFields=M.fn.clearInputs=function(r){var a=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();a.test(e)||"textarea"==t?this.value="":"checkbox"==e||"radio"==e?this.checked=!1:"select"==t?this.selectedIndex=-1:"file"==e?/MSIE/.test(navigator.userAgent)?M(this).replaceWith(M(this).clone(!0)):M(this).val(""):r&&(!0===r&&/hidden/.test(e)||"string"==typeof r&&M(this).is(r))&&(this.value="")})},M.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},M.fn.enable=function(e){return e===undefined&&(e=!0),this.each(function(){this.disabled=!e})},M.fn.selected=function(r){return r===undefined&&(r=!0),this.each(function(){var e=this.type;if("checkbox"==e||"radio"==e)this.checked=r;else if("option"==this.tagName.toLowerCase()){var t=M(this).parent("select");r&&t[0]&&"select-one"==t[0].type&&t.find("option").selected(!1),this.selected=r}})},M.fn.ajaxSubmit.debug=!1}),jqUploadI18nIt={"maxFileCountErrorStr":"non pu&ograve; esssere caricato. Numero massimo file consentiti: ","extErrorStr":"non pu&ograve; essere caricato. Estensioni ammesse: ","dragDropStr":"oppure trascina qui il documento","uploadStr":"Allega","deletelStr":"Cancella","abortStr":"Annulla","downloadStr":"Scarica","multiDragErrorStr":"&Egrave; permesso il caricamento di un file alla volta","duplicateErrorStr":"non pu&ograve; esssere caricato. Esiste gi&agrave;","uploadErrorStr":"Upload non consentito","sizeErrorStr":"&egrave; troppo pesante. Peso massimo consentito: ","genericError":"Errore"},function(y){y.fn.ajaxForm==undefined&&console.log("lo script dipende da ajaxForm");var S={};S.fileapi=y('<input type="file" />').get(0).files!==undefined,S.formdata=window.FormData!==undefined,y.fn.uploadFile=function(t){if(_thisElem=y(this),_thisId=y(_thisElem).attr("id"),0==y(_thisElem).length)return!1;var i=y.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,allowedTypes:"*",acceptFiles:"*",fileName:"uploadfile",formData:!1,dynamicFormData:!1,tabIndex:100,maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!1,showDelete:!0,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:") ",showFileSize:!1,showProgress:!0,nestedForms:!0,focusedClass:!1,showDownload:!1,onLoad:function(){},onSelect:function(){return!0},onSubmit:function(){},onSuccess:function(){},onError:function(){},onCancel:function(){},onAbort:function(){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,serialize:!0,sequential:!1,sequentialCount:2,customProgressBar:!1,elementAttachForm:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",localization:"It",dragDropStr:"Drag &amp; Drop Files",uploadStr:"Upload",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:"auto",dragdropWidth:"auto",showPreview:!1,previewHeight:"auto",previewWidth:"100%",extraHTML:!1,uploadQueueOrder:"top",headers:{}},t);if(0!=i.localization&&"undefined"!=typeof window["jqUploadI18n"+i.localization]){i18nArray=window["jqUploadI18n"+i.localization];var r={dragDropStr:i18nArray.dragDropStr,maxFileCountErrorStr:i18nArray.maxFileCountErrorStr,extErrorStr:i18nArray.extErrorStr,deletelStr:i18nArray.deletelStr,uploadStr:i18nArray.uploadStr,abortStr:i18nArray.abortStr,downloadStr:i18nArray.downloadStr,multiDragErrorStr:i18nArray.multiDragErrorStr,duplicateErrorStr:i18nArray.duplicateErrorStr,sizeErrorStr:i18nArray.sizeErrorStr,uploadErrorStr:i18nArray.uploadErrorStr,sizeErrorStr:i18nArray.sizeErrorStr,genericError:i18nArray.genericError};y.extend(i,r)}this.fileCounter=1,this.selectedFiles=0;var n="ajax-file-upload-"+(new Date).getTime();this.formGroup=n,this.errorLog=y("<div></div>"),this.responses=[],this.existingFileNames=[],S.formdata||(i.dragDrop=!1),S.formdata&&1!==i.maxFileCount||(i.multiple=!1),y(this).html("");var l=this,u=y("<div>"+i.uploadStr+"</div>");y(u).addClass(i.uploadButtonClass),function e(){if(y.fn.ajaxForm){if(i.dragDrop){var t=y('<div class="'+i.dragDropContainerClass+'"></div>').width(i.dragdropWidth);y(l).append(t),y(t).append(u),y(t).append('<span class="ddtext">'+i.dragDropStr+"</span>"),r=l,a=i,o=t,o.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),y(this).addClass(a.dragDropHoverClass)}),o.on("dragover",function(e){e.stopPropagation(),e.preventDefault();var t=y(this);t.hasClass(a.dragDropContainerClass)&&!t.hasClass(a.dragDropHoverClass)&&t.addClass(a.dragDropHoverClass)}),o.on("drop",function(e){e.preventDefault(),y(this).removeClass(a.dragDropHoverClass),r.errorLog.html("");var t=e.originalEvent.dataTransfer.files;if(!a.multiple&&1<t.length)return a.showError&&y("<div class='"+a.errorClass+"'>"+a.multiDragErrorStr+"</div>").appendTo(r.errorLog),void 0;0!=a.onSelect(t)&&f(a,r,t)}),o.on("dragleave",function(){y(this).removeClass(a.dragDropHoverClass)}),y(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),y(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault();var t=y(this);t.hasClass(a.dragDropContainerClass)||t.removeClass(a.dragDropHoverClass)}),y(document).on("drop",function(e){e.stopPropagation(),e.preventDefault(),y(this).removeClass(a.dragDropHoverClass)})}else y(l).append(u);y(l).append(l.errorLog),i.showQueueDiv?l.container=y(i.showQueueDiv):l.container=y("<div class='ajax-file-upload-container'></div>").insertAfter(y(l)),i.onLoad.call(this,l,i.fileName),function s(l,u,d,c){var e="ajax-upload-id-"+(new Date).getTime();0!=d.focusedClass&&(y(document).on("focus","#"+e,function(){y("#"+l.attr("id")).addClass(d.focusedClass)}),y(document).on("blur","#"+e,function(){y("#"+l.attr("id")).removeClass(d.focusedClass)}));var p=y("<form method='"+d.method+"' action='"+d.url+"' enctype='"+d.enctype+"'></form>");var t='<input type="file" tabindex="'+d.tabIndex+'" id="'+e+'" name="'+d.fileName+'" accept="'+d.acceptFiles+'">';d.multiple&&(d.fileName.indexOf("[]")!=d.fileName.length-2&&(d.fileName+="[]"),t='<input type="file" tabindex="'+d.tabIndex+'" id="'+e+'" name="'+d.fileName+'" accept="'+d.acceptFiles+'" multiple>');var r=y(t).appendTo(p);r.change(function(){l.errorLog.html("");d.allowedTypes.toLowerCase().split(",");var e=[];if(this.files){for(i=0;i<this.files.length;i++)e.push(this.files[i].name);if(0==d.onSelect(this.files))return}else{var t=y(this).val(),r=[];if(e.push(t),!v(l,d,t))return d.showError&&y("<div class='"+d.errorClass+"'><b>"+t+"</b> "+d.extErrorStr+d.allowedTypes+"</div>").appendTo(l.errorLog),void 0;if(r.push({name:t,size:"NA"}),0==d.onSelect(r))return}if(b(d,l),c.unbind("click"),p.hide(),s(l,u,d,c),p.addClass(u),d.serialize&&S.fileapi&&S.formdata){p.removeClass(u);var a=this.files;p.remove(),f(d,l,a)}else{for(var o="",i=0;i<e.length;i++)d.showFileCounter?o+=l.fileCounter+d.fileCounterStyle+e[i]+"<br>":o+=e[i]+"<br>",l.fileCounter++;if(-1!=d.maxFileCount&&l.selectedFiles+e.length>d.maxFileCount)return d.showError&&y("<div class='"+d.errorClass+"'><b>"+o+"</b> "+d.maxFileCountErrorStr+d.maxFileCount+"</div>").appendTo(l.errorLog),void 0;l.selectedFiles+=e.length;var n=new x(l,d);n.filename.html(o),w(p,d,n,e,l,null)}});d.nestedForms?(p.css({"margin":0,"padding":0}),c.css({position:"relative",cursor:"default"}),r.css({"position":"absolute","cursor":"pointer","top":"0","width":"100%","height":"100%","left":"0","z-index":"100","opacity":"0.0","filter":"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),p.appendTo(c)):(0!=d.elementAttachForm?anchorElem=d.elementAttachForm:anchorElem="body",p.prependTo(y(anchorElem)),p.css({margin:0,padding:0,display:"block",position:"absolute",left:"-99999px"}),-1!=navigator.appVersion.indexOf("MSIE ")?c.attr("for",e):c.click(function(){r.click()}))}(l,n,i,u)}else window.setTimeout(e,10);var r,a,o}(),this.startUpload=function(){y("form").each(function(){y(this).hasClass(l.formGroup)&&d.push(y(this))}),1<=d.length&&c()},this.getFileCount=function(){return l.selectedFiles},this.stopUpload=function(){y("."+i.abortButtonClass).each(function(){y(this).hasClass(l.formGroup)&&y(this).click()}),y("."+i.cancelButtonClass).each(function(){y(this).hasClass(l.formGroup)&&y(this).click()})},this.cancelAll=function(){y("."+i.cancelButtonClass).each(function(){y(this).hasClass(l.formGroup)&&y(this).click()})},this.update=function(e){i=y.extend(i,e)},this.reset=function(e){l.fileCounter=1,l.selectedFiles=0,l.errorLog.html(""),0!=e&&l.container.html("")},this.remove=function(){l.container.html(""),y(l).remove()},this.createProgress=function(t,e,r){var a=new x(this,i);a.progressDiv.show(),a.progressbar.width("100%");var o="";return o=i.showFileCounter?l.fileCounter+i.fileCounterStyle+t:t,i.showFileSize&&(o+=" ("+m(r)+")"),a.filename.html(o),l.fileCounter++,l.selectedFiles++,i.showPreview&&(a.preview.attr("src",e),a.preview.show()),i.showDownload&&(a.download.show(),a.download.click(function(){i.downloadCallback&&i.downloadCallback.call(l,[t],a)})),i.showDelete&&(a.del.show(),a.del.click(function(){a.statusbar.hide().remove();var e=[t];i.deleteCallback&&i.deleteCallback.call(this,e,a,l,i.fileName),l.selectedFiles-=1,b(i,l)})),a},this.getResponses=function(){return this.responses};var d=[],o=[],a=!1;function c(){a||(a=!0,function e(){if(i.sequential||(i.sequentialCount=99999),0==d.length&&0==o.length)i.afterUploadAll&&i.afterUploadAll(l),a=!1;else{if(o.length<i.sequentialCount){var t=d.shift();t!=undefined&&(o.push(t),t.removeClass(l.formGroup),t.submit())}window.setTimeout(e,100)}}())}function m(e){var t="",r=e/1e3;if(1e3<parseInt(r)){var a=r/1e3;t=parseFloat(a.toFixed(2))+" MB"}else t=r.toFixed(2)+" KB";return t}function h(e){var t=[];t="string"==jQuery.type(e)?e.split("&"):y.param(e).split("&");var r,a,o=t.length,i=[];for(r=0;r<o;r++)t[r]=t[r].replace(/\+/g," "),a=t[r].split("="),i.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])]);return i}function f(e,t,r){for(var a=0;a<r.length;a++)if(v(t,e,r[a].name))if(e.allowDuplicates||!g(t,r[a].name))if(-1!=e.maxFileSize&&r[a].size>e.maxFileSize)e.showError&&y("<div class='"+e.errorClass+"'><b>"+r[a].name+"</b> "+e.sizeErrorStr+m(e.maxFileSize)+"</div>").appendTo(t.errorLog);else if(-1!=e.maxFileCount&&t.selectedFiles>=e.maxFileCount)e.showError&&y("<div class='"+e.errorClass+"'><b>"+r[a].name+"</b> "+e.maxFileCountErrorStr+e.maxFileCount+"</div>").appendTo(t.errorLog);else{t.selectedFiles++,t.existingFileNames.push(r[a].name);var o=e,i=new FormData,n=e.fileName.replace("[]","");i.append(n,r[a]);var s=e.formData;if(s)for(var l=h(s),u=0;u<l.length;u++)l[u]&&i.append(l[u][0],l[u][1]);o.fileData=i;var d=new x(t,e),c="";c=e.showFileCounter?t.fileCounter+e.fileCounterStyle+r[a].name:r[a].name,e.showFileSize&&(c+=" ("+m(r[a].size)+")"),d.filename.html(c);var p=y("<form style='display:block; position:absolute;left: 150px;' class='"+t.formGroup+"' method='"+e.method+"' action='"+e.url+"' enctype='"+e.enctype+"'></form>");p.appendTo("body");var f=[];f.push(r[a].name),w(p,o,d,f,t,r[a]),t.fileCounter++}else e.showError&&y("<div class='"+e.errorClass+"'><b>"+r[a].name+"</b> "+e.duplicateErrorStr+"</div>").appendTo(t.errorLog);else e.showError&&y("<div class='"+e.errorClass+"'><b>"+r[a].name+"</b> "+e.extErrorStr+e.allowedTypes+"</div>").appendTo(t.errorLog)}function v(e,t,r){var a=t.allowedTypes.toLowerCase().split(/[\s,]+/g),o=r.split(".").pop().toLowerCase();return!("*"!=t.allowedTypes&&jQuery.inArray(o,a)<0)}function g(e,t){var r=!1;if(e.existingFileNames.length)for(var a=0;a<e.existingFileNames.length;a++)(e.existingFileNames[a]==t||i.duplicateStrict&&e.existingFileNames[a].toLowerCase()==t.toLowerCase())&&(r=!0);return r}function p(e,t){if(e.existingFileNames.length)for(var r=0;r<t.length;r++){var a=e.existingFileNames.indexOf(t[r]);-1!=a&&e.existingFileNames.splice(a,1)}}function b(r,e){if(r.showFileCounter){var a=y(e.container).find(".ajax-file-upload-filename").length;e.fileCounter=a+1,y(e.container).find(".ajax-file-upload-filename").each(function(){var e=y(this).html().split(r.fileCounterStyle),t=(parseInt(e[0]),a+r.fileCounterStyle+e[1]);y(this).html(t),a--})}}function x(e,t){var r=null;return r=t.customProgressBar?new t.customProgressBar(e,t):new function(e,t){return this.statusbar=y("<div class='ajax-file-upload-statusbar'></div>").width(t.statusBarWidth),this.preview=y("<img class='ajax-file-upload-preview' />").width(t.previewWidth).height(t.previewHeight).appendTo(this.statusbar).hide(),this.filename=y("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=y("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=y("<div class='ajax-file-upload-bar'></div>").appendTo(this.progressDiv),this.abort=y("<div>"+t.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=y("<div>"+t.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=y("<div>"+t.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=y("<div>"+t.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=y("<div>"+t.deletelStr+"</div>").appendTo(this.statusbar).hide(),this.abort.addClass("ajax-file-upload-red"),this.done.addClass("ajax-file-upload-green"),this.download.addClass("ajax-file-upload-green"),this.cancel.addClass("ajax-file-upload-red"),this.del.addClass("ajax-file-upload-red"),this}(e,t),r.abort.addClass(e.formGroup),r.abort.addClass(t.abortButtonClass),r.cancel.addClass(e.formGroup),r.cancel.addClass(t.cancelButtonClass),t.extraHTML&&(r.extraHTML=y("<div class='extrahtml'>"+t.extraHTML()+"</div>").insertAfter(r.filename)),"bottom"==t.uploadQueueOrder?y(e.container).append(r.statusbar):y(e.container).prepend(r.statusbar),r}function w(i,n,s,l,u,e){var t={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:n.method,data:n.formData,formData:n.fileData,dataType:n.returnType,headers:n.headers,beforeSubmit:function(e,t,r){if(0!=n.onSubmit.call(this,l)){if(n.dynamicFormData){var a=h(n.dynamicFormData());if(a)for(var o=0;o<a.length;o++)a[o]&&(n.fileData!=undefined?r.formData.append(a[o][0],a[o][1]):r.data[a[o][0]]=a[o][1])}return n.extraHTML&&y(s.extraHTML).find("input,select,textarea").each(function(){n.fileData!=undefined?r.formData.append(y(this).attr("name"),y(this).val()):r.data[y(this).attr("name")]=y(this).val()}),!0}return s.statusbar.append("<div class='"+n.errorClass+"'>"+n.uploadErrorStr+"</div>"),s.cancel.show(),i.remove(),s.cancel.click(function(){d.splice(d.indexOf(i),1),p(u,l),s.statusbar.remove(),n.onCancel.call(u,l,s),u.selectedFiles-=l.length,b(n,u)}),!1},beforeSend:function(e){s.progressDiv.show(),s.cancel.hide(),s.done.hide(),n.showAbort&&(s.abort.show(),s.abort.click(function(){p(u,l),e.abort(),u.selectedFiles-=l.length,n.onAbort.call(u,l,s)})),S.formdata?s.progressbar.width("1%"):s.progressbar.width("5%")},uploadProgress:function(e,t,r,a){98<a&&(a=98);var o=a+"%";1<a&&s.progressbar.width(o),n.showProgress&&s.progressbar.html(o)},success:function(e,t,r){if(s.cancel.remove(),o.pop(),"json"==n.returnType&&"object"==y.type(e)&&e.hasOwnProperty(n.customErrorKeyStr)){s.abort.hide();var a=e[n.customErrorKeyStr];return n.onError.call(this,l,200,a,s,r),n.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+n.errorClass+"'>Errore: "+a+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),u.selectedFiles-=l.length,i.remove(),void 0}u.responses.push(e),s.progressbar.width("100%"),n.showProgress&&(s.progressbar.html("100%"),setTimeout(function(){s.progressbar.css("visibility","hidden")},1e3)),s.abort.hide(),n.onSuccess.call(this,l,e,r,s,u),n.showStatusAfterSuccess?(n.showDone?(s.done.show(),s.done.click(function(){s.statusbar.hide("slow"),s.statusbar.remove()})):s.done.hide(),n.showDelete?(s.del.show(),s.del.click(function(){p(u,l),s.statusbar.hide().remove(),n.deleteCallback&&n.deleteCallback.call(this,e,s,u,n.fileName),u.selectedFiles-=l.length,b(n,u)})):s.del.hide()):(s.statusbar.hide("slow"),s.statusbar.remove()),n.showDownload&&(s.download.show(),s.download.click(function(){n.downloadCallback&&n.downloadCallback(e,s)})),i.remove()},error:function(e,t,r){s.cancel.remove(),o.pop(),s.abort.hide(),"abort"==e.statusText?(s.statusbar.hide("slow").remove(),b(n,u)):(n.onError.call(this,l,t,r,s,e),n.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+n.errorClass+"'>"+n.genericError+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),u.selectedFiles-=l.length),i.remove()}};n.showPreview&&null!=e&&"image"==e.type.toLowerCase().split("/").shift()&&!function(e,t){if(e){t.show();var r=new FileReader;r.onload=function(e){t.attr("src",e.target.result)},r.readAsDataURL(e)}}(e,s.preview),n.autoSubmit?(i.ajaxForm(t),d.push(i),c()):(n.showCancel&&(s.cancel.show(),s.cancel.click(function(){d.splice(d.indexOf(i),1),p(u,l),i.remove(),s.statusbar.remove(),n.onCancel.call(u,l,s),u.selectedFiles-=l.length,b(n,u)})),i.ajaxForm(t))}return this}}(jQuery);